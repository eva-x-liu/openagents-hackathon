# 📖 BookClub Core - 使用指南

## 🎯 系统简介

**BookClub Core** 是一个基于《你是你吃出来的》的读书会全案生成系统。

通过三个 AI Agent 协同工作，快速产出完整的读书会策划方案（从需求到执行物料）。

---

## 📋 三个 Agent 分工

| Agent | 角色 | 输入 | 输出 |
|-------|------|------|------|
| **bc-intake** | 需求收集官 | 你的想法描述 | 结构化需求文档 |
| **bc-content** | 内容生产官 | 需求文档 | 讲书逐字稿（基于 PDF + 膳食规则） |
| **bc-ops** | 执行官 | 需求 + 内容 | 可执行物料包（文案+SOP） |

---

## 💾 多格式输出（微信友好）

**所有 Agent 输出会自动生成 3 种格式，保存到 `output/` 目录！**

```
output/
├── intake_20260106_153025.md            ← Markdown 原文（开发者查看）
├── intake_20260106_153025.docx          ← Word 文档（微信公众号编辑器）
├── intake_20260106_153025_wechat.txt    ← 微信纯文本（朋友圈复制）
├── content_20260106_153142.md           ← Content Markdown
├── content_20260106_153142.docx         ← Content Word（上万字也不怕）
├── content_20260106_153142_wechat.txt   ← Content 微信版
├── ops_20260106_153305.md               ← Ops Markdown
├── ops_20260106_153305.docx             ← Ops Word
└── ops_20260106_153305_wechat.txt       ← Ops 微信版
```

### 📱 三种格式用途

| 格式 | 用途 | 适用场景 |
|------|------|----------|
| **`.md`** | Markdown 原文 | 开发者查看、Git 版本控制 |
| **`.docx`** | Word 文档 | 微信公众号编辑器（保留格式）|
| **`_wechat.txt`** | 微信纯文本 | 朋友圈文案（逐条复制）|

### 🎯 微信生态使用建议

**微信公众号文章：**
```
1. 打开 output/content_xxx.docx
2. 全选复制（Ctrl+A / Cmd+A）
3. 粘贴到微信公众号编辑器
4. 格式自动保留（标题、列表、表格）
```

**朋友圈文案：**
```
1. 打开 output/ops_xxx_wechat.txt
2. 找到需要的文案段落（用 emoji 分隔）
3. 逐条复制到朋友圈
```

**好处：**
- ✅ 不需要手动转换格式
- ✅ Word 格式在微信编辑器完美显示
- ✅ 微信版用 emoji 替代 Markdown，视觉友好
- ✅ 上万字内容也能完整复制

**流程简化：**
```
发消息 → Agent 回复 → 自动生成 3 种格式 → 根据用途选择文件 → 一键复制到微信
```

### 📊 格式转换示例

**Markdown 原文（.md）：**
```markdown
## Day 1：营养学的真相

### 书中精华

- **蛋白质摄入**：每天体重×0.8-1.0g
- **鸡蛋建议**：每天1个，不弃蛋黄
```

**Word 文档（.docx）：**
```
标题样式：Day 1：营养学的真相
副标题样式：书中精华
项目符号列表：
  • 蛋白质摄入：每天体重×0.8-1.0g
  • 鸡蛋建议：每天1个，不弃蛋黄
```

**微信版（_wechat.txt）：**
```
━━━━━━━━━━━━━━━━
📌【Day 1：营养学的真相】
━━━━━━━━━━━━━━━━

▸ 书中精华

  · 【蛋白质摄入】：每天体重×0.8-1.0g
  · 【鸡蛋建议】：每天1个，不弃蛋黄
```

---

---

## 💡 最佳实践：使用引用功能

**OpenAgents Studio 支持消息引用！** 这是最高效的工作方式：

```
Step 1: @bc-intake [发送需求]
        ↓
Step 2: 引用 Intake 消息 → @bc-content [添加指令]
        ↓
Step 3: 引用 Content 消息 → @bc-ops [添加指令]
        ↓
        完成！
```

**操作方法：**
1. 找到要引用的消息
2. 点击消息顶端右上角的 💬（聊天气泡）图标
3. 输入 `@agent-name` 和你的指令
4. 发送

**优势：**
- ✅ 无需手动复制粘贴
- ✅ 保留完整上下文
- ✅ 操作简单快捷

**⚠️ 限制：**
- 一次只能引用一条消息
- 如果 Ops 需要完整的 Intake 信息，建议使用"方法 2：从文件复制"

---

## 🚀 完整使用流程（5步）

### Step 1：启动系统

```bash
cd /Users/eva/Documents/OpenAgent/bookclub_core
./multi_start.sh
```

等待提示"系统启动成功"。

---

### Step 2：打开 Studio

访问：**http://localhost:8700/studio**

进入：**Channels** → **#general**

**你会看到系统自动发送的欢迎消息，包含：**
- 📖 系统说明
- 🚀 使用流程
- 📝 完整 Prompt 模板
- 🎯 极简示例

---

### Step 3：发送需求给 Intake Agent

**📝 初始 Prompt 模板：**

```
@bc-intake

我是一名营养师，想做一个 3 天的读书会。

【书籍信息】
书名：《你是你吃出来的》
作者：夏萌

【主理人信息】
专业特长：神经营养学 / 慢病管理 / 其他
风格偏好：专业严谨 / 温情亲切

【项目参数】
交付周期：3天 / 5天 / 7天
招募周期：7天
形式：线上+文字

【产品信息】（可选）
产品名：复合B族维生素
功效：支持神经递质、改善疲劳
定位：辅助工具（不是主角）
```

**🎯 实际示例：**

```
@bc-intake

我是一名营养师，想做一个 3 天的读书会。

书籍：《你是你吃出来的》
主理人特长：神经营养学
交付周期：3天
招募周期：7天
形式：线上+文字

产品：复合B族维生素（支持神经递质、改善疲劳）
产品定位：辅助工具
```

**预期输出（约 10 秒）：**
```
═══════════════════════════════════
📋 读书会策划需求单
═══════════════════════════════════

【书籍信息】
- 书名：《你是你吃出来的》
- 作者：夏萌
- PDF路径：data/you_are_what_you_eat.pdf

【主理人信息】
- 身份：营养师
- 专业特长：神经营养学
- 风格偏好：专业严谨

【项目参数】
- 交付周期：3天
- 招募周期：7天
- 实施形式：线上+文字

【产品信息】
- 产品名称：复合B族维生素
- 核心功效：支持神经递质、改善疲劳
- 产品定位：辅助工具

═══════════════════════════════════
✅ 信息收集完成，可传递给 @bc-content
═══════════════════════════════════

──────────────────────────────────────────────────
📋 下一步：请复制上述【INTAKE 输出】，@bc-content 并粘贴，触发内容生成。
```

---

### Step 4：生成讲书内容

**📝 方法 1：使用引用功能（推荐）⭐**

1. 在 `#general` 频道找到 Intake Agent 的回复消息
2. **点击消息顶端右上角的 💬 图标**
3. 在引用框中输入：

```
@bc-content

请生成 Day 1 的完整逐字稿，主题是"营养学的真相 - 蛋白质的重要性"
```

4. 发送（Content Agent 会自动看到引用的完整 Intake 输出）

---

**📝 方法 2：从文件复制**

打开 `output/intake_xxxxxxxx.md` 文件，复制内容后：

```
@bc-content

[粘贴 output/intake_xxx.md 的内容]

请生成 Day 1 的完整逐字稿，主题是"营养学的真相 - 蛋白质的重要性"
```

**预期输出（约 30-60 秒）：**
```
🧠【CONTENT】已接单。
✅ 膳食规则已加载
✅ PDF 已挂载
正在生成内容...

──────────────────────────────────

📄【CONTENT 输出】

# Day 1：营养学的真相

## 2.1 书中精华（15分钟）

各位好，我是XX，一名营养师。

接下来3天，我们一起读夏萌老师的《你是你吃出来的》。

这本书的第一句话，就颠覆了我的认知：
"你的身体，就是你吃进去的食物的总和。"

什么意思？

书里讲了一个案例：
一位45岁的高管张先生...
（完整讲书内容，基于 PDF 知识库）

## 2.2 延展知识（10分钟）

作为营养师，我想补充一个知识点。

书里提到"蛋白质是修复的基础"，为什么蛋白质这么重要？

从神经营养学来看...
（基于主理人专业的延伸）

## 2.3 解决方案（5分钟）

书里说"每天要吃够蛋白质"，怎么具体做？

**通用方案：**
- 早餐：2个鸡蛋 + 一杯牛奶
- 午餐：一掌心的肉/鱼
- 晚餐：一块豆腐

根据食物成分表：
- 鸡蛋（100g）：蛋白质 13.3g
- 鸡胸肉（100g）：蛋白质 24.6g
- 豆腐（100g）：蛋白质 8.1g

**蛋白质计算公式：体重(kg) × 0.8-1.0g**

示例：60kg成年人，需要 48-60g/天

⚠️ 注意：根据《中国居民膳食指南2022》，鸡蛋每天1个，不弃蛋黄。

## 🌱 2.4 产品种草（3-5分钟）

对了，书里提到"B族维生素是能量代谢的关键"...
（轻描淡写，激发好奇）

──────────────────────────────────────────────────
📋 下一步：请复制上述【CONTENT 输出】，@bc-ops 并粘贴，触发最终整合。
```

**✅ 关键检查点（验证膳食规则约束）：**
- 鸡蛋：说"每天1个"✓
- 蛋黄：提到"不弃蛋黄"✓
- 蛋白质：用"体重×0.8-1.0g"✓
- 引用书中内容✓

---

### Step 5：生成执行物料包

**📝 方法 1：使用引用功能（最简单）⭐**

1. 在 `#general` 频道找到 Content Agent 的回复消息
2. **点击消息顶端右上角的 💬 图标**
3. 在引用框中输入：

```
@bc-ops

请生成完整的执行物料包（Part 3-7）
```

4. 发送（Ops Agent 会看到引用的 Content 输出，其中包含需求信息）

---

**📝 方法 2：从文件复制（内容较长时）**

- 打开 `output/intake_xxxxxxxx.md`
- 打开 `output/content_xxxxxxxx.md`（可能很长！）

```
@bc-ops

【需求文档】
[粘贴 output/intake_xxx.md 的内容]

【讲书内容】
[粘贴 output/content_xxx.md 的内容]

请生成完整的执行物料包（Part 3-7）
```

---

**💡 提示：** 
- 引用功能一次只能引用一条消息
- 如果 Content 输出太长（上万字），引用可能被截断
- 如果 Ops 需要完整的 Intake + Content 信息，建议使用"方法 2"从文件复制

**🎯 推荐做法：**
- **日常使用：** 引用 Content（通常已包含关键需求信息）
- **完整输出：** 使用方法 2，同时提供 Intake + Content 文件内容

**预期输出（约 40-60 秒）：**
```
🧩【OPS】已接单。
✅ 膳食规则已加载
正在生成物料包...

──────────────────────────────────

📌【OPS 最终版 - 可直接使用的物料包】

# Part 3：时间轴与 SOP

## 3.1 总体时间线
| 阶段 | 时间 | 主要任务 |
|------|------|----------|
| 招募期 | D-7 至 D-1（7天） | 朋友圈预热、接龙报名 |
| 交付期 | D1 至 D3（3天） | 讲书、互动、种草 |
| 结营 | D3 下午 | 完整销讲、接龙促单 |

## 3.2 招募期 SOP（7天）
| 日期 | 时间 | 动作 | 内容要点 |
|------|------|------|----------|
| D-7 | 08:00 | 朋友圈1 | 预告：我要开读书会了 |
...

# Part 4：招募期文案（21条）

## 4.1 朋友圈文案（17条）

### D-7 第1条（预告）
---
📖 我要开一期读书会了

读的是夏萌老师的《你是你吃出来的》
——一本颠覫我认知的临床营养学著作...

（完整文案）

# Part 5：交付期文案

## 5.1 开营文案
🎉 欢迎来到《你是你吃出来的》读书会！...

# Part 6：资源清单

# Part 7：销讲资源包
```

---

## 💡 核心特性

### 1. 基于权威知识库

| 知识库 | 内容 | 用途 |
|--------|------|------|
| 《你是你吃出来的》PDF | 夏萌老师著作（4MB） | 讲书内容依据 |
| 食物成分表 | 1285种食物数据 | 精准营养数据 |
| 膳食指南2022 | 中国营养学会权威规则 | 约束输出准确性 |

### 2. 严格遵守膳食规则

AI 输出自动遵守《中国居民膳食指南2022》：

| 规则 | 说明 |
|------|------|
| 鸡蛋 | 每天最多1个，不弃蛋黄 |
| 食盐 | 每天<5g（2022新标准） |
| 牛奶 | 300-500ml/天 |
| 主食 | 每天≥150g |
| 高血脂患者胆固醇 | <200mg/天 |

**不会出现的错误建议：**
- ❌ "每天2个鸡蛋"
- ❌ "丢掉蛋黄"
- ❌ "不吃主食减肥"
- ❌ "多喝牛奶"

### 3. 递进式销讲策略

| 天数 | 第四部分内容 | 目的 |
|------|--------------|------|
| Day 1 | 产品种草（轻描淡写） | 激发好奇 |
| Day 2 | 用户见证（真实案例） | 建立信任 |
| Day 3 | 产品差异化（对比竞品） | 塑造价值 |
| 结营 | 完整销讲（痛点→行动指令） | 促单成交 |

---

## 🎨 更多 Prompt 示例

### 示例 1：简化版（最少信息）

```
@bc-intake

我想做一个3天的读书会，书是《你是你吃出来的》，
我是营养师，想推广B族维生素。
```

→ Intake 会追问缺失的信息

---

### 示例 2：详细版（完整信息）

```
@bc-intake

我是一名临床营养师，专注慢病营养调理，风格专业但温情。

想做一个5天的读书会，书是《你是你吃出来的》，
主题围绕"慢病可以逆转"。

招募期7天，形式是线上社群+文字逐字稿。

产品是复合营养素（B族+Omega-3+矿物质），
功效是支持慢病恢复，定位是辅助工具。
```

→ 直接获得完整需求文档

---

### 示例 3：只生成某一天的内容

```
@bc-content

[粘贴需求]

请只生成 Day 2 的逐字稿，主题是"慢病的真相 - 糖尿病篇"
```

---

### 示例 4：调整侧重点

```
@bc-content

[粘贴需求]

请生成 Day 1 逐字稿，重点讲解：
1. 高血压患者如何通过营养调理
2. 钾钠平衡的重要性
3. 具体的饮食调整方案
```

---

## ⚙️ 系统管理

### 启动系统

```bash
cd /Users/eva/Documents/OpenAgent/bookclub_core
./multi_start.sh
```

**启动时间**：约 12-15 秒

**启动日志**：
```
✅ [Ready] INTAKE 就绪 | 引擎: gemini-2.0-flash-exp
✅ [Ready] CONTENT 就绪 | 引擎: gemini-2.0-flash-thinking-exp
✅ [System] 膳食规则已加载（7486 字符）
📤 [System] 正在上传 PDF 知识库（约 4MB，需 10-30 秒）...
✅ [System] PDF 上传成功！ID: files/xxx
✅ [Ready] OPS 就绪 | 引擎: gemini-2.0-flash-exp
✅ [System] 膳食规则已加载（7486 字符）
```

---

### 查看日志

```bash
# 实时查看某个 Agent 的日志
tail -f intake.log
tail -f content.log  # 包含 PDF 上传信息
tail -f ops.log

# 查看所有日志
tail -f *.log
```

---

### 停止系统

```bash
./stop.sh
```

---

### 重启系统

```bash
./stop.sh && sleep 3 && ./multi_start.sh
```

---

## 🔧 优化配置

### PDF 文件复用（可选）

首次启动后，从 `content.log` 中获取 PDF File ID：

```bash
grep "PDF 上传成功" content.log
```

输出示例：
```
✅ [System] PDF 上传成功！ID: files/r6ruhyj8yha2
```

将 File ID 保存到 `.env`：

```bash
echo "PDF_FILE_REF=files/r6ruhyj8yha2" >> .env
```

下次启动会自动复用（节省 10-30 秒）。

**⚠️ 注意**：Gemini 文件有效期 **48 小时**，过期需重新上传。

---

## 📊 性能说明

| Agent | 响应时间 | 原因 |
|-------|----------|------|
| bc-intake | 5-10秒 | 对话简单 |
| bc-content | 30-60秒 | 读取 PDF + 膳食规则 + 生成长文本 |
| bc-ops | 40-60秒 | 生成大量文案 |

**💡 提示**：Content Agent 是最慢的，因为需要处理 PDF 知识库。

---

## ❓ 常见问题

### Q1：为什么要手动复制粘贴？

A：这是**手动流水线**设计。优点：
- ✅ 每一步可检查
- ✅ 可以调整中间输出
- ✅ 更灵活

**未来可能改为自动流水线。**

---

### Q2：Agent 没有回复？

**排查步骤：**

1. 检查日志
```bash
tail -50 content.log  # 查看错误信息
```

2. 检查是否正确 @agent
```
@bc-intake  # 正确
bc-intake   # 错误（缺少@）
```

3. 重启系统
```bash
./stop.sh && sleep 3 && ./multi_start.sh
```

---

### Q3：Content 输出不符合膳食规则？

**不应该出现：**
- "每天2个鸡蛋"
- "丢掉蛋黄"
- "不吃主食"

**如果出现，请：**
1. 检查 `膳食规则已加载` 日志
2. 查看 `data/dietary_rules.md` 是否存在
3. 重启系统

---

### Q4：如何修改 Agent 的行为？

**修改配置文件：**
- `agents/intake.yaml` - Intake Agent
- `agents/content.yaml` - Content Agent
- `agents/ops.yaml` - Ops Agent

编辑 `instruction` 部分，然后重启。

---

### Q5：成本如何？

使用 Gemini 2.0 Flash（免费额度或付费）：

| 操作 | 成本 |
|------|------|
| 单次完整流程 | ~$0.012 |
| 4美金预算 | 可跑 300+ 次 |

---

## 🎯 最佳实践

### ✅ 推荐做法

1. **第一次使用**：按照完整流程走一遍（Intake → Content → Ops）
2. **提供完整信息**：书籍、主理人、周期、产品等
3. **检查 Content 输出**：验证是否符合膳食规则
4. **灵活调整**：可以只用其中一个或两个 Agent

### ❌ 避免

1. ❌ 需求过于模糊（"我想做读书会"）
2. ❌ 忽略医学严谨性（营养建议需审核）
3. ❌ 期望完全不修改（AI 是辅助，不是替代）

---

## 📞 技术支持

**如遇问题，请查看：**

1. **日志文件**：`*.log`
2. **启动脚本输出**：终端信息
3. **Studio 错误提示**

**文档参考：**
- `启动和关闭.md` - 系统管理
- `测试流水线.md` - 测试案例
- `目录说明.md` - 项目结构

---

**祝你的读书会策划顺利！** 🎊
